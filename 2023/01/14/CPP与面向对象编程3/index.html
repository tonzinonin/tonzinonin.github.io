<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>c++与面向对象编程3 | final fantasy</title><meta name="author" content="某不知名的作者"><meta name="copyright" content="某不知名的作者"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="创建一个对象当我们创建一个类的时候，我们就需要进行实例化了，实例化总是会占用内存，就算我们实例化一个空的对象，也至少要占用一个字节的内存。我们有两种方式进行实例化，区别是内存从哪里来，我们在哪里创建对象。应用程序会吧内存分成两个主要的部分：堆和栈，还有其它的部分，比如说源代码部分，此时他是机器码。 栈分配 内存的栈和堆当程序启动后，操作系统所要做的就是将整个程序加载到内存，并且分配一大堆的物理ra">
<meta property="og:type" content="article">
<meta property="og:title" content="c++与面向对象编程3">
<meta property="og:url" content="https://tonzinonin.github.io/2023/01/14/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B3/index.html">
<meta property="og:site_name" content="final fantasy">
<meta property="og:description" content="创建一个对象当我们创建一个类的时候，我们就需要进行实例化了，实例化总是会占用内存，就算我们实例化一个空的对象，也至少要占用一个字节的内存。我们有两种方式进行实例化，区别是内存从哪里来，我们在哪里创建对象。应用程序会吧内存分成两个主要的部分：堆和栈，还有其它的部分，比如说源代码部分，此时他是机器码。 栈分配 内存的栈和堆当程序启动后，操作系统所要做的就是将整个程序加载到内存，并且分配一大堆的物理ra">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/01/12/f8943481ff2f250b.jpg">
<meta property="article:published_time" content="2023-01-14T15:17:23.000Z">
<meta property="article:modified_time" content="2023-01-17T12:03:53.731Z">
<meta property="article:author" content="某不知名的作者">
<meta property="article:tag" content="Cpp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2023/01/12/f8943481ff2f250b.jpg"><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="https://tonzinonin.github.io/2023/01/14/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'c++与面向对象编程3',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-17 20:03:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/OIP.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s3.bmp.ovh/imgs/2023/01/12/f8943481ff2f250b.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">final fantasy</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">c++与面向对象编程3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-14T15:17:23.000Z" title="发表于 2023-01-14 23:17:23">2023-01-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-17T12:03:53.731Z" title="更新于 2023-01-17 20:03:53">2023-01-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="c++与面向对象编程3"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="创建一个对象"><a href="#创建一个对象" class="headerlink" title="创建一个对象"></a>创建一个对象</h2><p>当我们创建一个类的时候，我们就需要进行实例化了，实例化总是会占用内存，就算我们实例化一个空的对象，也至少要占用一个字节的内存。<br>我们有两种方式进行实例化，区别是内存从哪里来，我们在哪里创建对象。<br>应用程序会吧内存分成两个主要的部分：堆和栈，还有其它的部分，比如说源代码部分，此时他是机器码。</p>
<p>栈分配</p>
<h2 id="内存的栈和堆"><a href="#内存的栈和堆" class="headerlink" title="内存的栈和堆"></a>内存的栈和堆</h2><p>当程序启动后，操作系统所要做的就是将整个程序加载到内存，并且分配一大堆的物理ram，使我们的实际应用程序可以运行。栈和堆是ram当中实际存在的两个区域，<strong>stack</strong>通常是一个预定义大小的内存区域，通常约为2MB左右，<strong>heap</strong>也是一个预定义了默认值的区域，但是它可以生长，并且可以随着应用程序的进行而改变。</p>
<p><strong>这两个内存区域的实际位置，在我们的ram当中是完全一样的</strong></p>
<p>很多人倾向于认为栈可能是存储在cpu缓存中或者类似的地方，或者是它活跃在缓存cache当中，因为我们在不断访问它。<br>事实上不是所有的栈内存都会存储在这个场合当中。这不是它的工作方式。</p>
<p>在我们程序当中，内存是用来实际存储数据的。我们需要一个地方来存储运行程序所需的数据，不管是局部变量还是从文件当中读取的东西。<br>栈和堆的工作原理非常的不同，但是本质上它们所做的事情是一样的。</p>
<p>区别：<br>1.定义的方式不同</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">Vector2</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">int</span> x <span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">//栈</span>
<span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
Vector2 vector<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token operator">*</span>hvalue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token comment">//堆，使用new关键字</span>
<span class="token keyword">int</span><span class="token operator">*</span> harray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
harray<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
harray<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
harray<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
harray<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
harray<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
Vector2<span class="token operator">*</span> hvector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">*</span>hval <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> havlue<span class="token punctuation">;</span>
<span class="token keyword">delete</span> harray<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> hvector<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.内存的分配方式不同</p>
<p><strong>在栈上</strong>，分配的内存都是连续的。添加一个int，则栈指针（栈顶部的指针）就会移动四个字节。连续分配的数据在内存当中都是连续的，栈分配数据是直接吧数据堆在一起（移动栈指针），所以栈分配数据会比较快。<br>如果离开作用域，在栈中分配的所有内存都会弹出，内存被释放。<br><img src="https://s3.bmp.ovh/imgs/2023/01/15/bb94d866f7688ac3.png"></p>
<p>我们输入了array的地址，可以发现array的数据被排布地整整齐齐，但是稍微细心就可以发现这一行又两个重复的5<br>这其中一个(后面那个)事实上是value变量地址下的值，由于是栈内存分配，这两个值是紧紧挨在一起的。<br><em>我们可能会发现这其中有一些字节，这是因为我们在调试模式下运行，它添加了安全守卫(safety guards)在所有的变量周围，以确保我们不会溢出所有的变量</em></p>
<p><strong>在堆上</strong>，分配的内存实际不连续的，new实际上做的就是在内存块的空闲部分”见缝插针”找到空闲的内存块，然后把它用一个指针来圈起来，然后返回这个指针。（都是如果空闲链表找不到合适的内存块，则会想操作系统索要更多的内存，而这种操作是很麻烦的，而且潜在成本是巨大的）<br>离开作用域之后，堆中的内存不会被释放。</p>
<p>建议能在站上分配就在栈上分配，不能够在栈上分配或者是有特殊需求的时候（比如需要生存周期比函数作用域更长，或者需要分配一些更大的数据），才在堆上分配。</p>
<p>new关键字实际上调用了一个叫做malloc的函数，memory allocate的缩写。这样做通常会调用底层操作系统或者平台的特定函数，这将在堆上为你分配内存。当你启动你的应用的时候，你会的到一定数量的ram分配给你，你的程序会维护一个叫做<strong>空闲列表</strong>(free list)的东西，它可以跟踪哪些内存块是空闲的，malloc将会调用这些地方的内存。</p>
<p>3.cache miss<br>栈分配比堆分配更好。</p>
<h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><p>new的主要目的就是在<strong>堆上分配内存</strong><br>new + 数据类型&#x2F;类&#x2F;数组…<br>new后面的东西决定了必要的分配大小。<br>new需要花费时间，因为它需要在空闲列表当中寻找到一个符合要求的内存块。<br>调用new的时候，事实上也会发生调用malloc，malloc需要传入一个size（多少字节），然后返回一个指针。<br>使用new的时候，一定要使用<strong>delete</strong>，不然内存就无法回到空闲列表，内存无法得到释放</p>
<h2 id="CPP隐式转换以及重载"><a href="#CPP隐式转换以及重载" class="headerlink" title="CPP隐式转换以及重载"></a>CPP隐式转换以及重载</h2><p>cpp事实上允许编译器堆代码进行一次隐式转换。<br>如果我们一开始有一个数据类型，然后有另一个类型，在两者之间，CPP允许隐式进行转换，而不需要一个cast强制进行转换。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>

<span class="token keyword">class</span> <span class="token class-name">Entity</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string m_Name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_Age<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Entity</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">m_Name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_Age</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token function">Entity</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">m_Name</span><span class="token punctuation">(</span><span class="token string">"Unknown"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_Age</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Entity <span class="token function">test1</span><span class="token punctuation">(</span><span class="token string">"cherno"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Entity <span class="token function">test2</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    Entity test3 <span class="token operator">=</span> <span class="token string">"cherno"</span><span class="token punctuation">;</span> <span class="token comment">//报错</span>
    Entity test4 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"cherno"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Entity test5 <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span> <span class="token comment">//发生隐式转换</span>

    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如上，在test5中，int型的23就被隐式转换为一个Entity对象，这是<strong>因为Entity类中有一个Entity(int age)构造函数，因此可以调用这个构造函数，然后把23作为他的唯一参数，就可以创建一个Entity对象。</strong></p>
<p>我们也能看到，对于语句<code>Entity test3 = &quot;lk&quot;;</code>会报错，原因是<strong>只能进行一次隐式转换</strong>，<code>&quot;lk&quot;</code>是<code>const char</code>数组，这里需要先转换为<code>std::string</code>，再从string转换为Entity变量，两次隐式转换是不行的，所以会报错。但是写为<code>Entity test4 = std::string(&quot;lk&quot;);</code>就可以进行隐式转换。</p>
<p>尽量避免隐式转换，隐式转换可读性较差</p>
<p><strong>explicit</strong><br>explicit禁用这个隐式implicit的功能，explicit关键字放在构造函数的前面，如果你有一个explicit的构造函数，这意味着没有隐式的转换，必须显示调用此构造函数</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token keyword">class</span> <span class="token class-name">Entity</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string m_Name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m_Age<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Entity</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">m_Name</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_Age</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">explicit</span> <span class="token function">Entity</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span>  <span class="token comment">//声明为explicit</span>
        <span class="token operator">:</span> <span class="token function">m_Name</span><span class="token punctuation">(</span><span class="token string">"Unknown"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">m_Age</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Entity <span class="token function">test1</span><span class="token punctuation">(</span><span class="token string">"cherno"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Entity <span class="token function">test2</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    Entity test3 <span class="token operator">=</span> <span class="token string">"cherno"</span><span class="token punctuation">;</span> 
    Entity test4 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"cherno"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Entity test5 = 23; 报错</span>

    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>加了explicit后还想隐式转换，则可以：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Entity test5 <span class="token operator">=</span> <span class="token punctuation">(</span>Entity<span class="token punctuation">)</span><span class="token number">22</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="运算符重载"><a href="#运算符重载" class="headerlink" title="运算符重载"></a>运算符重载</h2><p>CPP允许在程序中定义或者更改运算符的行为<br>事实上运算符就是一个函数</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token keyword">struct</span> <span class="token class-name">Vector2</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">float</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token function">Vector2</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span><span class="token keyword">float</span> y<span class="token punctuation">)</span> 
        <span class="token operator">:</span><span class="token function">x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    Vector2 <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector2</span><span class="token punctuation">(</span>x <span class="token operator">+</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> other<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    Vector2 <span class="token keyword">operator</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword">const</span>  <span class="token comment">//定义+操作符</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Add</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    Vector2 <span class="token function">Multiply</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Vector2</span><span class="token punctuation">(</span>x <span class="token operator">*</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span> y <span class="token operator">*</span> other<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    Vector2 <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">const</span> Vector2<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword">const</span>  <span class="token comment">//定义*操作符</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">Multiply</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Vector2 <span class="token function">position</span><span class="token punctuation">(</span><span class="token number">4.0f</span><span class="token punctuation">,</span> <span class="token number">4.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Vector2 <span class="token function">speed</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">1.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Vector2 <span class="token function">powerup</span><span class="token punctuation">(</span><span class="token number">1.1f</span><span class="token punctuation">,</span> <span class="token number">1.1f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//改变speed</span>
    Vector2 result1 <span class="token operator">=</span> position<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>speed<span class="token punctuation">.</span><span class="token function">Multiply</span><span class="token punctuation">(</span>powerup<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//无重载方式</span>
    Vector2 result2 <span class="token operator">=</span> position <span class="token operator">+</span> speed <span class="token operator">*</span> powerup<span class="token punctuation">;</span> <span class="token comment">//重载方式</span>

    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="this关键字"><a href="#this关键字" class="headerlink" title="this关键字"></a>this关键字</h2><p>通过this，可以访问成员函数（属于一个类的函数）或者方法。在方法内部，我们可以引用this。</p>
<p><strong>this是一个指向当前对象实例的指针，该方法属于这个对象实例</strong></p>
<p>this关键字存在的理由就是这样不用每个对象都要划分空间去保存函数的声明和定义，只需要在保存一次，然后调用函数的时候传入不同的this就可以了</p>
<p>在CPP中，我们可以写一个非静态方法，为了调用这个方法，我们实例化一个对象来调用。关键字this是指向该对象的指针，这实际上堆方法的一般工作方式非常重要。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstring></span></span>

<span class="token keyword">class</span> <span class="token class-name">Entity</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x <span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token function">Entity</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">//Entity* e = this;</span>
        <span class="token keyword">this</span> <span class="token operator">-></span> x <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">this</span> <span class="token operator">-></span> y <span class="token operator">=</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">//delete this</span>
    <span class="token comment">//最好不要这样写，如果你delete this之后，试图访问任何类的成员数据，你就会嗝屁，因为内存已经被释放了。</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>另一个有用的场合是，如果我们想调这个类之外的函数，那就不是类函数了。如果我们想在</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstring></span></span>

<span class="token keyword">void</span> <span class="token function">PrintEntity</span><span class="token punctuation">(</span><span class="token keyword">const</span> Entity<span class="token operator">&amp;</span> e<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Entity</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x <span class="token punctuation">,</span> y<span class="token punctuation">;</span>
    <span class="token function">Entity</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token comment">//Entity* e = this;</span>
        <span class="token keyword">this</span> <span class="token operator">-></span> x <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">this</span> <span class="token operator">-></span> y <span class="token operator">=</span> y<span class="token punctuation">;</span>
        Entity<span class="token operator">&amp;</span> e <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token function">PrintEntity</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//如果在一个const方法中，我们可以将*this赋值给const Entity&amp;。（吧指针传给引用）</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">PrintEntity</span><span class="token punctuation">(</span><span class="token keyword">const</span> Entity<span class="token operator">&amp;</span> e<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">//print</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="对象生存周期"><a href="#对象生存周期" class="headerlink" title="对象生存周期"></a>对象生存周期</h2><p>关于<strong>生存期</strong>对于基于栈的变量意味着什么<br>每次我们在c++进入一个作用域，都是在进入一个栈帧，他不一定非得是将数据推进一个栈帧。<br>作用域可以是任何东西，比如说函数的作用域，或者for和while的作用域。或者空作用域，类作用域。</p>
<p>关于栈堆的详细介绍可以见之前的笔记。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">CreateArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//在栈上创建的</span>
    <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span><span class="token operator">*</span> a <span class="token operator">=</span> <span class="token function">CreateArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//不能正常工作</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="智能指针"><a href="#智能指针" class="headerlink" title="智能指针"></a>智能指针</h2><p>智能指针本质上是一个原始指针的包装，当你调用一个智能指针，他就会调用new并且为你分配内存。这些内存会在某一个时刻自动释放。</p>
<h3 id="unique-ptr"><a href="#unique-ptr" class="headerlink" title="unique_ptr"></a>unique_ptr</h3><p>智能指针在C++14被引入<br>unique_ptr是作用域指针，是超出作用域的时候，它会被销毁，然后调用delete。</p>
<p>你不能复制一个unique_ptr，因为如果你复制一个unique_ptr，你会有两个指针，两个unique_ptr指向同一个内存块。</p>
<p>如果其中一个指针释放内存了，也就是说，你指向同一块内存的第二个unique_ptr指向了已经被释放的内存。</p>
<p>unique_ptr的constructor是explicit的，不能使用隐式转换<br>最好使用std::unique_prt<Entity> entity &#x3D; std::make_unique<Entity>();因为如果构造函数碰巧抛出异常，不会的到一个没有引用的悬空指针而造成内存泄露，会稍微安全一些。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;memory></span></span>

<span class="token keyword">class</span> <span class="token class-name">Entity</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Create Entity!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">~</span><span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Destroyed Entity!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#123;</span><span class="token comment">//在特定的作用域下创建一个智能指针</span>
        std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Entity<span class="token operator">></span> entity <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_unique</span><span class="token generic class-name"><span class="token operator">&lt;</span>Entity<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Entity<span class="token operator">></span> e0 <span class="token operator">=</span> entity<span class="token punctuation">;</span><span class="token comment">//exception:cant copy</span>
        entity<span class="token operator">-></span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="shared-ptr"><a href="#shared-ptr" class="headerlink" title="shared_ptr"></a>shared_ptr</h3><p>与unique有点不同，shared_ptr实现的方式实际上取决于编译器和你在编译器当中使用的标准库。shared_ptr的工作原理是通过<strong>引用计数</strong>，引用计数基本上是一种方法，可以跟踪你的指针有多少个引用，一旦引用数为0，他就会被删除。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#123;</span>
        std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Entity<span class="token operator">></span> e0<span class="token punctuation">;</span>
        <span class="token punctuation">&#123;</span>
            std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Entity<span class="token operator">></span> sharedEntity <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>Entity<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//标准格式</span>
            e0 <span class="token operator">=</span> sharedEntity<span class="token punctuation">;</span><span class="token comment">//可以进行复制。</span>
        <span class="token punctuation">&#125;</span><span class="token comment">//此时sharedEntity已经“无了”，但是并没有调用析构函数，因为e0仍然是活的，并且持有对该Entity的引用，此时计数由2->1</span>
    <span class="token punctuation">&#125;</span><span class="token comment">//析构被调用，因为所有的引用都消失了，计数由1->0，内存被释放</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>shared_ptr需要分配另一块内存，叫做控制块，用来储存引用计数。也就是做两次分配，先做一次new Entity的分配，然后就是shared_ptr的控制内存块的分配。如果你使用make_shared你就可以把它们组合起来。这样更加有效率</p>
<p>优先选择unique_ptr，然后选择shared_ptr。</p>
<h3 id="weak-ptr"><a href="#weak-ptr" class="headerlink" title="weak_ptr"></a>weak_ptr</h3><p>可以与shared_ptr一起使用。<br>weak_ptr可以被复制，但是不会增加额外的控制块来控制计数，仅仅是声明整个指针还活着。<br>当你将一个shared_ptr赋值给另外一个shared_ptr，引用计数会增加，但是把一个shared_ptr赋值给了一个weak_ptr的时候，他不会增加引用计数。<br>使用场景：如果你想要Entity的所有权，就像你可能在排序一个Entity列表，你不关心它们是否有效，你只需要存储它们的一个引用就好了。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">&#123;</span>
    std<span class="token double-colon punctuation">::</span>weak_ptr<span class="token operator">&lt;</span>Entity<span class="token operator">></span> e0<span class="token punctuation">;</span>
    <span class="token punctuation">&#123;</span>
        std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Entity<span class="token operator">></span> sharedEntity <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>Entity<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e0 <span class="token operator">=</span> sharedEntity<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">//此时，此析构被调用，内存被释放</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CPP的赋值与拷贝构造函数"><a href="#CPP的赋值与拷贝构造函数" class="headerlink" title="CPP的赋值与拷贝构造函数"></a>CPP的赋值与拷贝构造函数</h2><p>拷贝指的是要求复制数据，复制内存。当我们想要把一个对象或一段数据从一个地方复制到另一个地方的时候。我们实际上有两个副本。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstring></span></span>

<span class="token keyword">struct</span> <span class="token class-name">Vector2</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">float</span> x <span class="token punctuation">,</span> y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    Vector2<span class="token operator">*</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Vector2 b <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token comment">//我们复制两个指针，本质上有相同的值</span>
    b<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">//但是如果我访问这个内存地址，设置为某一个值，在这种情况下是会同时影响a和b的，因为它们指向的是同一个内存地址</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">String</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">char</span><span class="token operator">*</span> m_Buffer<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> m_Size<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> string<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        m_Size <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_Buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>m_Size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">memcpy</span><span class="token punctuation">(</span>m_Buffer<span class="token punctuation">,</span>string<span class="token punctuation">,</span>m_Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_Buffer<span class="token punctuation">[</span>m_Size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">~</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> m_Buffer<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> stream<span class="token punctuation">,</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//把&lt;&lt;操作符重载函数声明为String类的友元，这样就可以在该重载函数中访问m_Buffer</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> stream<span class="token punctuation">,</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> string<span class="token punctuation">)</span> <span class="token comment">//&lt;&lt;操作符重载，用来打印我创建的字符串</span>
<span class="token punctuation">&#123;</span>
    stream <span class="token operator">&lt;&lt;</span> string<span class="token punctuation">.</span>m_Buffer<span class="token punctuation">;</span>
    <span class="token keyword">return</span> stream<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
    String string <span class="token operator">=</span> <span class="token string">"Cherno"</span><span class="token punctuation">;</span>
    String second <span class="token operator">=</span> string<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> string <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> second <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行会报错</p>
<p>当我们复制string的时候，cpp会自动复制所有的类成员变量，而这些成员变量组成了类(实际的内存空间)，它是由一个char*和一个unsigned int组成的，他将这些值复制到一个新的内存地址里面，这包含了second字符串。</p>
<p>现在内存有两个string，因为他们直接进行了复制。这种复制被称为“浅拷贝”<br>对于char* m_Buffer，他所作的是去复制这个指针。<br>在内存中的两个string有相同的char*的值，即相同的内存地址。</p>
<p>下面是将cherno中的e换成a的实现</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">String</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">char</span><span class="token operator">*</span> m_Buffer<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> m_Size<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> string<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        m_Size <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_Buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>m_Size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">memcpy</span><span class="token punctuation">(</span>m_Buffer<span class="token punctuation">,</span>string<span class="token punctuation">,</span>m_Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_Buffer<span class="token punctuation">[</span>m_Size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">~</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> m_Buffer<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span><span class="token comment">//重载运算符，目的是获取index下的reference</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> m_Buffer<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> stream<span class="token punctuation">,</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> stream<span class="token punctuation">,</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> string<span class="token punctuation">)</span> <span class="token comment">//&lt;&lt;操作符重载，用来打印我创建的字符串</span>
<span class="token punctuation">&#123;</span>
    stream <span class="token operator">&lt;&lt;</span> string<span class="token punctuation">.</span>m_Buffer<span class="token punctuation">;</span>
    <span class="token keyword">return</span> stream<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
    String string <span class="token operator">=</span> <span class="token string">"Cherno"</span><span class="token punctuation">;</span>
    String second <span class="token operator">=</span> string<span class="token punctuation">;</span>
    
    second<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span><span class="token comment">//替换</span>
    
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> string <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> second <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Charno
Charno<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这个例子已经很明显了</p>
<p>我们真正需要做的是，分配一个新的char数组，来存储复制的字符串。而我们现在做的是复制指针，两个字符串对象指向完全相同的内存缓冲区。</p>
<p>我们需要进行<strong>深拷贝</strong>这个方法<br>深拷贝复制整个对象。<br>我们可以使用<strong>拷贝构造函数</strong>：当你复制第二个字符串或者什么时，它会被调用<br>cpp在默认情况会给你一个拷贝构造函数。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">String</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">char</span><span class="token operator">*</span> m_Buffer<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> m_Size<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> string<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        m_Size <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_Buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>m_Size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">memcpy</span><span class="token punctuation">(</span>m_Buffer<span class="token punctuation">,</span>string<span class="token punctuation">,</span>m_Size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_Buffer<span class="token punctuation">[</span>m_Size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">/*
    String(const String&amp; other) : m_Buffer(other.m_Buffer) , m_Size(other.m_Size)//默认下的拷贝构造函数
    &#123;
    &#125;
    String(const String&amp; other) = delete;//禁用拷贝构造函数，不允许复制
    */</span>
	<span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">m_Size</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>m_Size<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        m_Buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>m_Size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//细节\0</span>
        <span class="token function">memcpy</span><span class="token punctuation">(</span>m_Buffer <span class="token punctuation">,</span> othter<span class="token punctuation">.</span>m_Buffer<span class="token punctuation">,</span> m_Size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token operator">~</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> m_Buffer<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span><span class="token comment">//重载运算符，目的是获取index下的reference</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> m_Buffer<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> stream<span class="token punctuation">,</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> stream<span class="token punctuation">,</span> <span class="token keyword">const</span> String<span class="token operator">&amp;</span> string<span class="token punctuation">)</span> 
<span class="token punctuation">&#123;</span>
    stream <span class="token operator">&lt;&lt;</span> string<span class="token punctuation">.</span>m_Buffer<span class="token punctuation">;</span>
    <span class="token keyword">return</span> stream<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span>String string<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> string <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span>
    String string <span class="token operator">=</span> <span class="token string">"Cherno"</span><span class="token punctuation">;</span>
    String second <span class="token operator">=</span> string<span class="token punctuation">;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
    second<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'a'</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行这个代码，输出：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Cherno
Charno<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>好像已经成功了，但是如果我们修改一下拷贝构造函数再运行</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">m_Size</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>m_Size<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
    	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Copied"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        m_Buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>m_Size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//细节\0</span>
        <span class="token function">memcpy</span><span class="token punctuation">(</span>m_Buffer <span class="token punctuation">,</span> othter<span class="token punctuation">.</span>m_Buffer<span class="token punctuation">,</span> m_Size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出：</p>
<pre class="line-numbers language-none"><code class="language-none">Copied
Copied
Cherno
Copied
Charno<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>c出现了三个string的复制，这看上去有些荒谬，因为我们不需要做这些复制。</p>
<p>当我们复制一个字符串的时候，我们再堆上分配内存，复制所有的内存，最后释放。但是我们事实上不需要这样做，我们想做的是，将现有的字符串直接进入这个Print函数。</p>
<p>做下面的修改就行：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> string<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> string <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>成员</strong>不包括指针和引用时，浅拷贝和深拷贝没区别。<br>cherno:“在基础使用的时候，使用const引用更好，总是通过const引用传递对象”</p>
<h2 id="箭头操作符"><a href="#箭头操作符" class="headerlink" title="箭头操作符"></a>箭头操作符</h2><p>箭头运算符必须是类的成员。</p>
<ol>
<li>一般将箭头运算符定义成了const成员，这是因为与递增和递剑运算符不一样，获取一个元素并不会改变类对象的状态。</li>
</ol>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	Entity e<span class="token punctuation">;</span>
    e<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    Entity<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token operator">&amp;</span>e<span class="token punctuation">;</span>
    ptr <span class="token operator">-></span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这样就可以调用</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="2">
<li>-&gt;的重载。</li>
</ol>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token keyword">class</span> <span class="token class-name">Entity</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> x<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">&#123;</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Hello!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">ScopedPtr</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Entity<span class="token operator">*</span> m_Ptr<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">ScopedPtr</span><span class="token punctuation">(</span>Entity<span class="token operator">*</span> ptr<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token function">m_Ptr</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">~</span><span class="token function">ScopedPtr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">delete</span> m_Ptr<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    Entity<span class="token operator">*</span> <span class="token keyword">operator</span><span class="token operator">-></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//重载操作符</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> m_Ptr<span class="token punctuation">;</span><span class="token comment">//返回一个Entity的指针</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#123;</span>
        ScopedPtr entity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        entity<span class="token operator">-></span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol start="3">
<li><p>计算成员变量的offset(偏移量)</p>
<p>引自B站评论：<br>因为”指针-&gt;属性”访问属性的方法实际上是通过把指针的值和属性的偏移量相加，得到属性的内存地址进而实现访问。 而把指针设为nullptr(0)，然后-&gt;属性就等于0+属性偏移量。编译器能知道你指定属性的偏移量是因为你把nullptr转换为类指针，而这个类的结构你已经写出来了(float x,y,z)，float4字节，所以它在编译的时候就知道偏移量(0,4,8)，所以无关对象是否创建</p>
</li>
</ol>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">vec2</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> x<span class="token punctuation">,</span>y<span class="token punctuation">;</span>
    <span class="token keyword">float</span> pos<span class="token punctuation">,</span>v<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>   
    <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token punctuation">(</span>vec2<span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token operator">-></span>x<span class="token punctuation">;</span> <span class="token comment">// x,y,pos,v的offset分别为0,4,8,12</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span>offset<span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="std-vector"><a href="#std-vector" class="headerlink" title="std::vector"></a>std::vector</h2><p>动态数组</p>
<h2 id="template-模板"><a href="#template-模板" class="headerlink" title="template(模板)"></a>template(模板)</h2><p><strong>模板</strong>：模板允许你定义一个可以根据你的用途进行编译的模板（有意义下）。故所谓模板，就是让编译器基于DIY的规则去为你写代码 。</p>
<h3 id="函数的模板（对形参）"><a href="#函数的模板（对形参）" class="headerlink" title="函数的模板（对形参）"></a>函数的模板（对形参）</h3><blockquote>
<p>不使用模板</p>
</blockquote>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token keyword">int</span> temp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    cout <span class="token operator">&lt;&lt;</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span>string temp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    cout <span class="token operator">&lt;&lt;</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token keyword">double</span> temp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    cout <span class="token operator">&lt;&lt;</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token number">5.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如果要用一个函数输出三个类型不同的东西，则要手动定义三个不同重载函数</span>
    <span class="token comment">//这其实就是一种复制粘贴就可以完成的操作</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>使用模板</p>
</blockquote>
<p>格式： <strong>template<typename T></strong></p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span>T temp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//把类型改成模板类型的名字如T就可以了</span>
    cout <span class="token operator">&lt;&lt;</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//干净简洁</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token number">5.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>通过<code>template</code>定义，则说明定义的是一个模板，它会在编译期被评估，<strong>所以template后面的函数其实不是一个实际的代码</strong>，<strong>只有当我们实际调用时，模板函数才会基于传递的参数来真的创建</strong> 。 只有当真正调用函数的时候才会被实际创建 。</p>
</blockquote>
<p>模板参数</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token keyword">void</span> <span class="token function">Print</span><span class="token punctuation">(</span>T temp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    cout <span class="token operator">&lt;&lt;</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里其实是隐式的传递信息给模板，可读性不高</span>
    <span class="token generic-function"><span class="token function">Print</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//可以显示的定义模板参数，声明函数接受的形参的类型！！！</span>
    <span class="token generic-function"><span class="token function">Print</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出的可以是数字，也可以是字符！这样的操纵性强了很多！！！</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="CPP的宏-macro"><a href="#CPP的宏-macro" class="headerlink" title="CPP的宏(macro)"></a>CPP的宏(macro)</h2><p>它能够将代码当中的文本替换为其它的东西，这基本上像是遍历我们的代码之后执行查找和替换</p>
<p>它可以使用形式参数，实参和变量这些来进行查找和替换。我们可以自定义调用和宏的方式。</p>
<h2 id="auto关键字"><a href="#auto关键字" class="headerlink" title="auto关键字"></a>auto关键字</h2><p>auto可以让c++自动推导出数据的类型。不管是创建、初始化变量数据的时候，还是将一个变量对另一个变量进行赋值的时候。</p>
<p>假设我们有一个string，我们创建了一个string，然后我们可能在类当中有一个函数，返回一个string。当我们对返回类型赋值的时候，比如返回我们现在这个函数的局部变量。我们不需要实际去输入string，我们只需要输入auto，然后就会计算出应该有的类型。</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token double-colon punctuation">::</span>string <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> <span class="token string">"Cherno"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    std<span class="token double-colon punctuation">::</span>string name <span class="token operator">=</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">auto</span> name <span class="token operator">=</span> <span class="token function">GetName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//都可以</span>
    cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">auto</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">//一个int</span>
    <span class="token keyword">auto</span> b <span class="token operator">=</span> <span class="token number">5L</span><span class="token punctuation">;</span> <span class="token comment">//一个long</span>
    <span class="token keyword">auto</span> c <span class="token operator">=</span> <span class="token number">5.5f</span><span class="token punctuation">;</span> <span class="token comment">//一个float</span>
    <span class="token keyword">auto</span> d <span class="token operator">=</span> <span class="token string">"cherno"</span><span class="token punctuation">;</span> <span class="token comment">//一个const char*</span>
    <span class="token comment">//不管右边是什么，我们都不需要对auto改变类型。</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在使用iterator的时候：</p>
<blockquote>
<p>在使用iterator 的时候，如：</p>
</blockquote>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span> strings<span class="token punctuation">;</span>
strings<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
strings<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token string">"Orange"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">></span><span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//不使用auto</span>
    it <span class="token operator">!=</span> strings<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>it <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span><span class="token comment">//肉眼可见的麻烦</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> strings<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//使用auto</span>
<span class="token punctuation">&#123;</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>it <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当类型名过长的时候可以使用auto</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map></span></span>

<span class="token keyword">class</span> <span class="token class-name">Device</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DeviceManager</span>
<span class="token punctuation">&#123;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Device <span class="token operator">*</span><span class="token operator">>></span> m_Devices<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Device <span class="token operator">*</span><span class="token operator">>></span> <span class="token operator">&amp;</span><span class="token function">GetDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> m_Devices<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    DeviceManager dm<span class="token punctuation">;</span>
    <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Device <span class="token operator">*</span><span class="token operator">>></span> <span class="token operator">&amp;</span>devices <span class="token operator">=</span> dm<span class="token punctuation">.</span><span class="token function">GetDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不使用auto</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> devices <span class="token operator">=</span> dm<span class="token punctuation">.</span><span class="token function">GetDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使用auto</span>

    std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>除此之外类型名过长的时候也可以使用using或typedef方法：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">using</span> DeviceMap <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Device<span class="token operator">*</span><span class="token operator">>></span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Device<span class="token operator">*</span><span class="token operator">>></span> DeviceMap<span class="token punctuation">;</span>

<span class="token keyword">const</span> DeviceMap<span class="token operator">&amp;</span> devices <span class="token operator">=</span> dm<span class="token punctuation">.</span><span class="token function">GetDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>auto使用建议</strong>：如果不是上面两种应用场景，请尽量不要使用auto！能不用，就不用！降低代码的可读性。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Cpp/">Cpp</a></div><div class="post_share"><div class="social-share" data-image="https://s3.bmp.ovh/imgs/2023/01/12/f8943481ff2f250b.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/01/12/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B2/"><img class="next-cover" src="https://s3.bmp.ovh/imgs/2023/01/12/12fe4ce985801876.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">c++与面向对象编程2</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/12/09/CPP%E6%A0%87%E5%87%86%E6%A8%A1%E6%9D%BF%E5%BA%93%E3%81%AE%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F/" title="CPP标准模板库の打开方式"><img class="cover" src="https://s3.bmp.ovh/imgs/2023/01/12/e92609f7d9e775f5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-09</div><div class="title">CPP标准模板库の打开方式</div></div></a></div><div><a href="/2023/01/12/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B2/" title="c++与面向对象编程2"><img class="cover" src="https://s3.bmp.ovh/imgs/2023/01/12/12fe4ce985801876.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-12</div><div class="title">c++与面向对象编程2</div></div></a></div><div><a href="/2022/11/15/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B1/" title="c++与面向对象编程1"><img class="cover" src="https://s3.bmp.ovh/imgs/2023/01/12/e92609f7d9e775f5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-15</div><div class="title">c++与面向对象编程1</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/OIP.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">某不知名的作者</div><div class="author-info__description">衬衫的价格是九磅十五便士</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/tonzinonin" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.</span> <span class="toc-text">创建一个对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%9A%84%E6%A0%88%E5%92%8C%E5%A0%86"><span class="toc-number">2.</span> <span class="toc-text">内存的栈和堆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#new"><span class="toc-number">3.</span> <span class="toc-text">new</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CPP%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2%E4%BB%A5%E5%8F%8A%E9%87%8D%E8%BD%BD"><span class="toc-number">4.</span> <span class="toc-text">CPP隐式转换以及重载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD"><span class="toc-number">5.</span> <span class="toc-text">运算符重载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#this%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">6.</span> <span class="toc-text">this关键字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%94%9F%E5%AD%98%E5%91%A8%E6%9C%9F"><span class="toc-number">7.</span> <span class="toc-text">对象生存周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="toc-number">8.</span> <span class="toc-text">智能指针</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#unique-ptr"><span class="toc-number">8.1.</span> <span class="toc-text">unique_ptr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shared-ptr"><span class="toc-number">8.2.</span> <span class="toc-text">shared_ptr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#weak-ptr"><span class="toc-number">8.3.</span> <span class="toc-text">weak_ptr</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CPP%E7%9A%84%E8%B5%8B%E5%80%BC%E4%B8%8E%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">9.</span> <span class="toc-text">CPP的赋值与拷贝构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%AD%E5%A4%B4%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">10.</span> <span class="toc-text">箭头操作符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#std-vector"><span class="toc-number">11.</span> <span class="toc-text">std::vector</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#template-%E6%A8%A1%E6%9D%BF"><span class="toc-number">12.</span> <span class="toc-text">template(模板)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E6%A8%A1%E6%9D%BF%EF%BC%88%E5%AF%B9%E5%BD%A2%E5%8F%82%EF%BC%89"><span class="toc-number">12.1.</span> <span class="toc-text">函数的模板（对形参）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CPP%E7%9A%84%E5%AE%8F-macro"><span class="toc-number">13.</span> <span class="toc-text">CPP的宏(macro)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#auto%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">14.</span> <span class="toc-text">auto关键字</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/01/14/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B3/" title="c++与面向对象编程3"><img src="https://s3.bmp.ovh/imgs/2023/01/12/f8943481ff2f250b.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="c++与面向对象编程3"/></a><div class="content"><a class="title" href="/2023/01/14/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B3/" title="c++与面向对象编程3">c++与面向对象编程3</a><time datetime="2023-01-14T15:17:23.000Z" title="发表于 2023-01-14 23:17:23">2023-01-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/12/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B2/" title="c++与面向对象编程2"><img src="https://s3.bmp.ovh/imgs/2023/01/12/12fe4ce985801876.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="c++与面向对象编程2"/></a><div class="content"><a class="title" href="/2023/01/12/CPP%E4%B8%8E%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B2/" title="c++与面向对象编程2">c++与面向对象编程2</a><time datetime="2023-01-12T10:26:12.000Z" title="发表于 2023-01-12 18:26:12">2023-01-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/20/%E5%9F%BA%E7%A1%80%E6%95%B0%E8%AE%BA/" title="基础数论"><img src="https://s3.bmp.ovh/imgs/2023/01/12/e92609f7d9e775f5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基础数论"/></a><div class="content"><a class="title" href="/2022/12/20/%E5%9F%BA%E7%A1%80%E6%95%B0%E8%AE%BA/" title="基础数论">基础数论</a><time datetime="2022-12-20T08:30:22.000Z" title="发表于 2022-12-20 16:30:22">2022-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/17/unity%E5%A4%A7%E8%84%91%E5%A4%8D%E5%81%A5/" title="unity大脑复健"><img src="https://s3.bmp.ovh/imgs/2023/01/12/b290daacd1b79e32.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="unity大脑复健"/></a><div class="content"><a class="title" href="/2022/12/17/unity%E5%A4%A7%E8%84%91%E5%A4%8D%E5%81%A5/" title="unity大脑复健">unity大脑复健</a><time datetime="2022-12-17T12:21:06.000Z" title="发表于 2022-12-17 20:21:06">2022-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/14/KMP/" title="KMP"><img src="https://s3.bmp.ovh/imgs/2023/01/12/4380663e3f60c5ab.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="KMP"/></a><div class="content"><a class="title" href="/2022/12/14/KMP/" title="KMP">KMP</a><time datetime="2022-12-14T06:21:25.000Z" title="发表于 2022-12-14 14:21:25">2022-12-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>